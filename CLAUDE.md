# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

A monorepo of 23+ MCP (Model Context Protocol) server implementations that wrap popular cybersecurity tools. Each server exposes security tools as MCP tools over stdio transport, enabling AI assistants to invoke them. Maintained by Cyprox (cyprox.io).

## Build Commands

### Build a single MCP server
```bash
cd <tool>-mcp && npm install && npm run build
```
`npm run build` runs `tsc` to compile TypeScript from `src/` to `build/index.js`.

### Build a single server with its tool dependencies
```bash
cd <tool>-mcp && ./build.sh
```
Each `build.sh` installs the underlying security tool (Go binary, Python package, etc.), runs `npm install && npm run build`, and updates the root `mcp-config.json` via `jq`.

### Build all servers (used in Docker)
```bash
./start.sh
```
Iterates all `*-mcp/` directories, runs each `build.sh`, then generates the unified `mcp-config.json`.

### Docker build
```bash
docker build -t cyprox/mcp-for-security .
```
Multi-stage build on `golang:1.24-bullseye` installing Node.js v24, Python3, Ruby, and all security tools.

## Running an MCP Server

```bash
node <tool>-mcp/build/index.js <binary-path> [additional-args]
```
Example: `node nmap-mcp/build/index.js nmap`

All servers communicate via stdio (StdioServerTransport). Configure in MCP clients:
```json
{
  "mcpServers": {
    "nmap-mcp": {
      "command": "node",
      "args": ["/path/to/nmap-mcp/build/index.js", "nmap"]
    }
  }
}
```

## Testing

No automated test suite exists. Testing is manual via MCP client integration.

## Architecture

```
AI Assistant / MCP Client
        │ MCP Protocol (JSON-RPC over stdio)
        ▼
MCP Server Layer (Node.js TypeScript)
  - McpServer instance from @modelcontextprotocol/sdk
  - Tool registration via server.tool()
  - Input validation via Zod schemas
        │ spawn / exec / HTTP API
        ▼
Security Tool Layer
  - Go binaries (alterx, amass, httpx, katana, nuclei, etc.)
  - Python scripts (commix, sqlmap, scoutsuite, arjun)
  - System binaries (nmap, masscan, sslscan)
  - HTTP APIs (crt.sh, MobSF, http-headers-security)
```

### MCP Server Pattern (all servers follow this)

Every server in `src/index.ts`:
1. Parses CLI args for binary path (`process.argv.slice(2)`)
2. Creates `McpServer` instance
3. Registers one or more tools with Zod input schemas
4. Spawns the security tool as a child process (or makes HTTP calls)
5. Returns output as `{ content: [{ type: "text", text: output }] }`
6. Connects via `StdioServerTransport`

### Three Execution Patterns

| Pattern | Used By | Mechanism |
|---------|---------|-----------|
| `child_process.spawn` | nmap, ffuf, sqlmap, masscan, most tools | Simple stdout/stderr capture |
| `node-pty` | httpx, nuclei, scoutsuite | Pseudo-terminal for tools with ANSI/colored output; strips ANSI codes before returning |
| HTTP/axios | crtsh, http-headers-security, mobsf | Direct API calls, no binary spawn |

### Config Generation

`mcp-config.json` at the repo root is auto-generated by `start.sh`/individual `build.sh` scripts. Each build script uses `jq` to add/update its entry. Do not edit this file manually.

## Conventions

- **Directory naming:** `<tool>-mcp/` (e.g., `nmap-mcp`, `httpx-mcp`)
- **Tool function naming:** Most use `do-<tool>` (e.g., `do-nmap`, `do-ffuf`), some use bare tool name (`amass`, `httpx`, `crtsh`)
- **TypeScript target:** ES2022, module: Node16, strict mode
- **Core deps:** `@modelcontextprotocol/sdk`, `zod` (all servers); `node-pty` (interactive tools); `axios` (API-based tools)
- **ANSI stripping:** Servers using `node-pty` include a `removeAnsiCodes()` helper
- **Error handling:** Promise-based — resolve on exit code 0/undefined, reject otherwise
- **Logging:** `console.error` for server status (stdout reserved for MCP protocol)

## Adding a New MCP Server

1. Create `<tool>-mcp/` directory following existing structure
2. Copy `tsconfig.json` from any existing server (they're identical)
3. Create `package.json` with `@modelcontextprotocol/sdk` and `zod`
4. Implement `src/index.ts` following the spawn/pty/API pattern appropriate for the tool
5. Create `build.sh` that installs the tool, runs `npm install && npm run build`, and updates `mcp-config.json`
6. Add entry to root `readme.md` tools table
7. Add the `.gitignore` file to make sure bloated files are not commited.
8. Create the MCP server `readme.md` file describing it's usage and setup.

## Requirements
Use context7 for documentation